<!DOCTYPE html>
<html lang="en-GB">

<head>
  <meta http-equiv="X-Clacks-Overhead" content="GNU Terry Pratchett" />
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
<link rel="shortcut icon" href="https://blog.melkorm.dev/images/favicon2.png" />
<title>Fixing SELinux and Kernel Blacklist Issues for L2TP VPNs on Fedora | melkorm&#39;s blog</title>
<meta name="title" content="Fixing SELinux and Kernel Blacklist Issues for L2TP VPNs on Fedora" />
<meta name="description" content="The problem
One of my projects requires L2TP VPN connection. Unfortunately it&rsquo;s outdated protocol and not recommended anymore thus Linux disabled it by default. Which, if you need to use it, requires additional setup and potential issues when upgrading the system.
Symptoms
When trying to connect to previously setup VPN it just throw an error.
Troubleshooting &amp; SELinux fix
We can use this command to see what went wrong with out connection:" />
<meta name="keywords" content="fedora,linux,l2tp,selinux,l2tp_ppp,l2tp_netlink,NetworkManager," />


<meta property="og:url" content="https://blog.melkorm.dev/fixing-selinux-and-kernel-blacklist-issues-for-l2tp-vpns-on-fedora/">
  <meta property="og:site_name" content="melkorm&#39;s blog">
  <meta property="og:title" content="Fixing SELinux and Kernel Blacklist Issues for L2TP VPNs on Fedora">
  <meta property="og:description" content="The problem One of my projects requires L2TP VPN connection. Unfortunately it’s outdated protocol and not recommended anymore thus Linux disabled it by default. Which, if you need to use it, requires additional setup and potential issues when upgrading the system.
Symptoms When trying to connect to previously setup VPN it just throw an error.
Troubleshooting &amp; SELinux fix We can use this command to see what went wrong with out connection:">
  <meta property="og:locale" content="en_GB">
  <meta property="og:type" content="article">
    <meta property="article:section" content="blog">
    <meta property="article:published_time" content="2025-11-21T00:07:44+01:00">
    <meta property="article:modified_time" content="2025-11-21T00:07:44+01:00">
    <meta property="article:tag" content="Fedora">
    <meta property="article:tag" content="Linux">
    <meta property="article:tag" content="L2tp">
    <meta property="article:tag" content="Selinux">
    <meta property="article:tag" content="L2tp_ppp">
    <meta property="article:tag" content="L2tp_netlink">




  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Fixing SELinux and Kernel Blacklist Issues for L2TP VPNs on Fedora">
  <meta name="twitter:description" content="The problem One of my projects requires L2TP VPN connection. Unfortunately it’s outdated protocol and not recommended anymore thus Linux disabled it by default. Which, if you need to use it, requires additional setup and potential issues when upgrading the system.
Symptoms When trying to connect to previously setup VPN it just throw an error.
Troubleshooting &amp; SELinux fix We can use this command to see what went wrong with out connection:">




  <meta itemprop="name" content="Fixing SELinux and Kernel Blacklist Issues for L2TP VPNs on Fedora">
  <meta itemprop="description" content="The problem One of my projects requires L2TP VPN connection. Unfortunately it’s outdated protocol and not recommended anymore thus Linux disabled it by default. Which, if you need to use it, requires additional setup and potential issues when upgrading the system.
Symptoms When trying to connect to previously setup VPN it just throw an error.
Troubleshooting &amp; SELinux fix We can use this command to see what went wrong with out connection:">
  <meta itemprop="datePublished" content="2025-11-21T00:07:44+01:00">
  <meta itemprop="dateModified" content="2025-11-21T00:07:44+01:00">
  <meta itemprop="wordCount" content="466">
  <meta itemprop="keywords" content="Fedora,Linux,L2tp,Selinux,L2tp_ppp,L2tp_netlink,NetworkManager">
<meta name="referrer" content="no-referrer-when-downgrade" />

  <style>
  :root {
    --width: 720px;
    --font-main: Verdana, sans-serif;
    --font-secondary: Verdana, sans-serif;
    --font-scale: 1em;
    --background-color: #fff;
    --heading-color: #222;
    --text-color: #444;
    --link-color: #3273dc;
    --visited-color: #8b6fcb;
    --blockquote-color: #222;
  }

  @media (prefers-color-scheme: dark) {
    :root {
      --background-color: #01242e;
      --heading-color: #eee;
      --text-color: #ddd;
      --link-color: #8cc2dd;
      --visited-color: #8b6fcb;
      --blockquote-color: #ccc;
    }
  }

  body {
    font-family: var(--font-secondary);
    font-size: var(--font-scale);
    margin: auto;
    padding: 20px;
    max-width: var(--width);
    text-align: left;
    background-color: var(--background-color);
    word-wrap: break-word;
    overflow-wrap: break-word;
    line-height: 1.5;
    color: var(--text-color);
  }

  h1,
  h2,
  h3,
  h4,
  h5,
  h6 {
    font-family: var(--font-main);
    color: var(--heading-color);
  }

  a {
    color: var(--link-color);
    cursor: pointer;
    text-decoration: none;
  }

  a:hover {
    text-decoration: underline;
  }

  nav a {
    margin-right: 8px;
  }

  strong,
  b {
    color: var(--heading-color);
  }

  button {
    margin: 0;
    cursor: pointer;
  }

  time {
    font-family: monospace;
    font-style: normal;
    font-size: 15px;
  }

  main {
    line-height: 1.6;
  }

  table {
    width: 100%;
  }

  hr {
    border: 0;
    border-top: 1px dashed;
  }

  img {
    max-width: 100%;
  }

  code {
    font-family: monospace;
    padding: 2px;
    border-radius: 3px;
  }

  blockquote {
    border-left: 1px solid #999;
    color: var(--blockquote-color);
    padding-left: 20px;
    font-style: italic;
  }

  footer {
    padding: 25px 0;
    text-align: center;
  }

  .title:hover {
    text-decoration: none;
  }

  .title h1 {
    font-size: 1.5em;
  }

  .inline {
    width: auto !important;
  }

  .highlight,
  .code {
    border-radius: 3px;
    margin-block-start: 1em;
    margin-block-end: 1em;
    overflow-x: auto;
  }

   
  ul.blog-posts {
    list-style-type: none;
    padding: unset;
  }

  ul.blog-posts li {
    display: flex;
  }

  ul.blog-posts li span {
    flex: 0 0 130px;
  }

  ul.blog-posts li a:visited {
    color: var(--visited-color);
  }

</style>
<meta
    name="google-site-verification"
    content="fGp3l5hbDnick6-4vgSqr6zaV-r0sot-ogcRdh4w-3A"
/>
<script async src="https://scripts.simpleanalyticscdn.com/latest.js"></script>
</head>

<body>
  <header><a href="/" class="title">
  <h2 style="display: flex; justify-content: left; gap: 5px;">
      
<img src="/images/me-gopher.jpg" width="30" height="30">
      melkorm&#39;s blog</h2>

</a>
<nav>
<a href="/">Home</a>

<a href="/blog/">Blog</a>

<a href="/about/">About</a>

</nav>
</header>
  <main> 
<h1>Fixing SELinux and Kernel Blacklist Issues for L2TP VPNs on Fedora</h1>
<p>
    <i>
        <time datetime='2025-11-21'>
            2025-11-21
        </time>
    </i>
</p>

<content> <h2 id="the-problem">The problem</h2>
<p>One of my projects requires L2TP VPN connection. Unfortunately it&rsquo;s outdated protocol and not recommended anymore thus Linux disabled it by default. Which, if you need to use it, requires additional setup and potential issues when upgrading the system.</p>
<h2 id="symptoms">Symptoms</h2>
<p>When trying to connect to previously setup VPN it just throw an error.</p>
<h2 id="troubleshooting--selinux-fix">Troubleshooting &amp; SELinux fix</h2>
<p>We can use this command to see what went wrong with out connection:</p>
<blockquote>
<p>$ sudo journalctl &ndash;no-hostname _COMM=nm-l2tp-service _COMM=ipsec _COMM=pluto _COMM=charon _COMM=kl2tpd _COMM=xl2tpd _COMM=pppd</p>
</blockquote>
<p>In <code>journalctl</code> I could see entries like this:</p>
<blockquote>
<p>lis 20 22:44:04 fedora NetworkManager[18340]: 2025/11/20 22:44:04 failed to instantiate application: failed to create L2TP context: failed to initialise data plane: failed to establish a netlink/L2TP connection: socket: permission denied</p>
</blockquote>
<p>After quick search I&rsquo;ve found that it&rsquo;s an issue with selinux policies after upgrading to Fedora 43 <sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup><sup id="fnref:2"><a href="#fn:2" class="footnote-ref" role="doc-noteref">2</a></sup>.</p>
<p>After applying the fix from <a href="https://bugzilla.redhat.com/show_bug.cgi?id=2407022#c6" target="_blank" rel="noopener">this comment</a>
 with policy taken from <a href="https://github.com/fedora-selinux/selinux-policy/issues/2259#issue-2426970978" target="_blank" rel="noopener">here</a>
 I got a new error:</p>
<blockquote>
<p>lis 20 22:57:02 fedora NetworkManager[20532]: 2025/11/20 22:57:02 failed to instantiate application: failed to create L2TP context: failed to initialise data plane: failed to establish a netlink/L2TP connection: netlink send: sendmsg: permission denied</p>
</blockquote>
<p>Which looks like some write permissions. So <a href="https://github.com/fedora-selinux/selinux-policy/issues/2259#issuecomment-3461259617" target="_blank" rel="noopener">these changes</a>
 to the policy were also required.</p>
<p>here is the full policy and commands to make it work:</p>
<p>We need to create a file, it can be anywhere on your system, named <code>kl2tpd.te</code>, with contents:</p>
<pre tabindex="0"><code>module kl2tpd 1.0;

require {
	type l2tpd_t;
	type sysfs_t;
	class file { open read };
	class netlink_generic_socket { bind create getattr getopt read write };
}

#============= l2tpd_t ==============
allow l2tpd_t self:netlink_generic_socket { bind create getattr getopt read write };
allow l2tpd_t sysfs_t:file { open read };
</code></pre><p>Next we need to run this commands:</p>
<pre tabindex="0"><code>$ checkmodule -M -m -o kl2tpd.mod kl2tpd.te
$ semodule_package -o kl2tpd.pp -m kl2tpd.mod
$ sudo semodule -i kl2tpd.pp
</code></pre><p>This will apply new module with correct policies.</p>
<h2 id="troubleshooting--kernel-modules-fix">Troubleshooting &amp; Kernel modules fix</h2>
<p>After fixing SELinux polices, I&rsquo;ve got my third error:</p>
<blockquote>
<p>lis 20 23:07:58 fedora NetworkManager[11289]: 2025/11/20 23:07:58 failed to instantiate application: failed to create L2TP context: failed to initialise data plane: failed to establish a netlink/L2TP connection: netlink receive: no such file or directory</p>
</blockquote>
<p>Which is quite different and is more about missing something, rather than selinux issues. To run properly L2TP/PPP VPN you need to enable them in the kernel as they are normally blacklisted. I did it previously but after kernel upgrade they were disabled again.</p>
<p>To enable them we need to update two files:</p>
<pre tabindex="0"><code>/etc/modprobe.d/l2tp_ppp-blacklist.conf
</code></pre><p>change <code>blacklist l2tp_netlink</code> to <code>#blacklist l2tp_netlink</code></p>
<p>and</p>
<pre tabindex="0"><code>/etc/modprobe.d/l2tp_netlink-blacklist.conf
</code></pre><p>change <code>blacklist l2tp_ppp</code> to <code>#blacklist l2tp_ppp</code>.</p>
<p>You can do that by using this commands:</p>
<pre tabindex="0"><code>$ sudo sed -i &#39;s/^blacklist l2tp_netlink/#blacklist l2tp_netlink/&#39; /etc/modprobe.d/l2tp_ppp-blacklist.conf
$ sudo sed -i &#39;s/^blacklist l2tp_ppp/#blacklist l2tp_ppp/&#39; /etc/modprobe.d/l2tp_netlink-blacklist.conf
</code></pre><p>Reboot and everything should work just fine.</p>
<div class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li id="fn:1">
<p><a href="https://bugzilla.redhat.com/show_bug.cgi?id=2406859" target="_blank" rel="noopener">Bug report 1</a>
&#160;<a href="#fnref:1" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:2">
<p><a href="https://bugzilla.redhat.com/show_bug.cgi?id=2406859" target="_blank" rel="noopener">Bug report 2</a>
&#160;<a href="#fnref:2" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
</ol>
</div>
 </content>

<div style="font-size:0.8em;display:flex;gap:16px;justify-content:center;">
  <p>
    
    <a href="https://blog.melkorm.dev/404-pages-with-vue.js-and-vue-router/">
      &lt;&lt; Previous Post</a>
        
  </p>
  <p>|</p>
  <p>
    
    <strike>Next Post >></strike>
    
  </p>
</div>


<p>
    
    <a href="https://blog.melkorm.dev/tag/fedora/">#fedora</a>
    
    <a href="https://blog.melkorm.dev/tag/linux/">#linux</a>
    
    <a href="https://blog.melkorm.dev/tag/l2tp/">#l2tp</a>
    
    <a href="https://blog.melkorm.dev/tag/selinux/">#selinux</a>
    
    <a href="https://blog.melkorm.dev/tag/l2tp_ppp/">#l2tp_ppp</a>
    
    <a href="https://blog.melkorm.dev/tag/l2tp_netlink/">#l2tp_netlink</a>
    
    <a href="https://blog.melkorm.dev/tag/networkmanager/">#networkmanager</a>
    
</p>

  </main>
  <footer>Made with <a href="https://github.com/janraasch/hugo-bearblog/">Hugo ʕ•ᴥ•ʔ Bear</a>
</footer>

  
</body>

</html>
